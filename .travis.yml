dist: focal
services:
  - docker
language: php
php:
  - '7.4'
git:
  depth: false
script:
  - tests/phplint.sh
  - tests/strict_types.sh
  - composer install
  - mv .env.sample .env
  - mv config/config.specific.sample.php config/config.specific.php
  - mv config/discord/config.specific.sample.php config/discord/config.specific.php
  - mv config/irc/config.specific.sample.php config/irc/config.specific.php
  - mv config/npc/config.specific.sample.php config/npc/config.specific.php
  - docker-compose --env-file test.env up -d mysql-integration-test
  - sleep 20
  - docker-compose --env-file test.env run --rm flyway-integration-test
  - docker-compose --env-file test.env run --rm smr-integration-test
