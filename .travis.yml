env:
  - DOCKER_COMPOSE_VERSION=1.4.2

before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
dist: focal
services:
  - docker
language: php
php:
  - '7.4'
git:
  depth: false
script:
  - docker-compose --version
  - tests/phplint.sh
  - tests/strict_types.sh
  - composer install
  - mv .env.sample .env
  - mv config/config.specific.sample.php config/config.specific.php
  - mv config/discord/config.specific.sample.php config/discord/config.specific.php
  - mv config/irc/config.specific.sample.php config/irc/config.specific.php
  - mv config/npc/config.specific.sample.php config/npc/config.specific.php
  - docker-compose --env-file test.env up -d mysql-integration-test
  - sleep 20
  - docker-compose --env-file test.env run --rm flyway-integration-test
  - docker-compose --env-file test.env run --rm smr-integration-test
