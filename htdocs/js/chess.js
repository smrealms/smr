(function(){function e(a){var d,e,f,g,h;b();var i=a.getElementsByTagName("TILE");for(f=0;f<i.length;f++){d=c(i[f],"X"),e=c(i[f],"Y"),document.getElementById("x"+d+"y"+e).innerHTML=c(i[f],"INNER_HTML"),availableMoves["x"+d+"y"+e]=[],h=i[f].getElementsByTagName("POSSIBLE_MOVE");for(g=0;g<h.length;g++)availableMoves["x"+d+"y"+e].push({x:c(h[g],"MOVE_X"),y:c(h[g],"MOVE_Y")})}document.getElementById("moveTable").innerHTML=c(a,"MOVE_TABLE"),document.getElementById("turn").innerHTML=c(a,"TURN"),a.getElementsByTagName("MOVE_MESSAGE").length>0&&alert(c(a,"MOVE_MESSAGE"))}var a=[],b,c,d;window.highlightMoves=function(c,e){var f,g,h;if(a.length==0){f=availableMoves["x"+c+"y"+e];if(f!=null)for(g=0;g<f.length;g++)toX=f[g].x,toY=f[g].y,h=$("#x"+toX+"y"+toY),a.push({ele:h,x:toX,y:toY}),h.click(function(a,b,c,e){return function(){d(a,b,c,e)}}(c,e,toX,toY)),h.addClass("chessHighlight")}else b()},b=function(){var b;while(b=a.pop())b.ele.removeClass("chessHighlight"),b.ele.click(function(a,b){return function(){highlightMoves(a,b)}}(b.x,b.y))},c=document.getElementsByTagName("body")[0].textContent==undefined?function(a,b){return a.getElementsByTagName(b)[0].text}:function(a,b){return a.getElementsByTagName(b)[0].textContent},d=function(a,b,c,d){$.get(submitMoveHREF,{x:a,y:b,toX:c,toY:d},e,"xml")}})()